from enum import Enum, IntEnum

from pydantic import BaseModel

from sekoia_automation.asset_connector.models.ocsf.device import Device


class KillChainPhase(Enum):
    UNKNOWN = "Unknown"
    RECONNAISSANCE = "Reconnaissance"
    WEAPONIZATION = "Weaponization"
    DELIVERY = "Delivery"
    EXPLOITATION = "Exploitation"
    INSTALLATION = "Installation"
    COMMAND_AND_CONTROL = "Command & Control"
    ACTIONS_ON_OBJECTIVES = "Actions on Objectives"
    OTHER = "Other"


class KillChainPhaseID(IntEnum):
    UNKNOWN = 0
    RECONNAISSANCE = 1
    WEAPONIZATION = 2
    DELIVERY = 3
    EXPLOITATION = 4
    INSTALLATION = 5
    COMMAND_AND_CONTROL = 6
    ACTIONS_ON_OBJECTIVES = 7
    OTHER = 99


class KillChain(BaseModel):
    phase: KillChainPhase
    phase_id: KillChainPhaseID | None = None


class FindingInformation(BaseModel):
    """
    FindingInformation model represents the information about a vulnerability finding.
    https://schema.ocsf.io/1.5.0/objects/finding_information
    """

    uid: str
    data_sources: list[str] | None = None
    title: str | None = None
    src_url: str | None = None
    kill_chain: list[KillChain] | None = None
    desc: str | None = None


class CVE(BaseModel):
    uid: str
    type: str


class VulnerabilityDetails(BaseModel):
    title: str | None = None
    references: list[str]
    cve: CVE


# https://schema.ocsf.io/1.5.0/classes/vulnerability_finding
class VulnerabilityOCSFModel(BaseModel):
    device: Device | None = None
    finding_info: FindingInformation
    vulnerabilities: VulnerabilityDetails
